<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Game</title>
</head>
<script src="static/pixi/pixi.min.js"></script>
<script src="/socket.io/socket.io.js"></script>
<script src="static/client/controller.js"></script>

<body>
  <script>
  "use strict";

  let type = "WebGL"
  if(!PIXI.utils.isWebGLSupported()){
    type = "canvas"
  }

  let controller = new Controller();

  let app = new PIXI.Application({
    width: controller.width,         // default: 800
    height: controller.height,        // default: 600
    antialias: true,    // default: false
    transparent: false, // default: false
    resolution: 1       // default: 1
  }
);

document.body.appendChild(app.view);
PIXI.loader
.add("static/res/grass.png")
.add("static/res/sand.png")
.add("static/res/edge.png")
.add("static/res/player.png")
.load(setup);


function Terrain(newPath)  {
  this.path=newPath;
}


let gameMap = new GameMap();
let players = [];
let currentPlayer = new CurrentPlayer();


function setup() {
  controller.newPlayer();
  controller.emitInput();
  controller.listenToUpdate();
  app.ticker.add(delta => gameLoop(delta));
}

function gameLoop(delta){
  app.stage.removeChildren();
  for (let i = 0; i < 21; i++) {
    for (let j = 0; j < 21; j++) {
      let square = new PIXI.Sprite(PIXI.loader.resources[gameMap.square[i][j].path].texture);
      square.x=controller.squareWidthInPixels*j-currentPlayer.xAbsolute%50;
      square.y=controller.squareHeightInPixels*i-currentPlayer.yAbsolute%50;
      app.stage.addChild(square);
    }
  }
  for (let id in players) {
    let player = players[id];
    let playerSprite = new PIXI.Sprite(PIXI.loader.resources['static/res/player.png'].texture);
    playerSprite.x=player.x;
    playerSprite.y=player.y;
    app.stage.addChild(playerSprite);
  }
}

////////////////////////////////////////////////////////////////////////////////
let socket = io();

let input = {
  up: false,
  down: false,
  left: false,
  right: false,
  direction:  Math.PI
}

document.addEventListener('keydown', function(event) {
  switch (event.keyCode) {
    case 65: // A
    input.left = true;
    break;
    case 87: // W
    input.up = true;
    break;
    case 68: // D
    input.right = true;
    break;
    case 83: // S
    input.down = true;
    break;
  }
});

document.addEventListener('keyup', function(event) {
  switch (event.keyCode) {
    case 65: // A
    input.left = false;
    break;
    case 87: // W
    input.up = false;
    break;
    case 68: // D
    input.right = false;
    break;
    case 83: // S
    input.down = false;
    break;
  }
});

document.addEventListener('mousemove', function(event) {
  currentPlayer.direction = Math.atan((400-event.y)/(event.x-500));
//  console.log(currentPlayer.direction);

  }
);




/////////////////////////////////////////////////////////////////////////////



</script>
</body>
</html>
